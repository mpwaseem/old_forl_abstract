let errorsContainer=$("div#errors-reporter");let totpModal=$("div#totpModal");function xhrCall(d,b,a,c){let defaultOptions={cache:false,type:"get",dataType:"json"};if(typeof(a)==="object"){$.extend(defaultOptions,a)}if(typeof(b)!=="object"){console.log("xhrCall expects object for second parameter");return false}defaultOptions.url=d;defaultOptions.data=b;$.ajax(defaultOptions).done(function(e){if(typeof(c)==="function"){if(defaultOptions.dataType==="json"){if(typeof(e)==="object"){c(e)}else{console.log("Expecting an object from XHR")}}else{c(e)}}}).fail(function(e,g,f){console.log("XHR Failed: "+g);console.log(f)})}function xhrForm(a,b){if($(a).is("form")){let to=$(a).attr("action");$(a).find(":submit").attr("disabled",true);xhrCall(to,$(a).serializeArray(),{type:"post"},b);$(a).find(":submit").attr("disabled",false)}}function processFormResult(b,a){if($(b).is("form")){if(typeof(a)==="object"){if(a.hasOwnProperty("messages")){let messages=a.messages;if($.isArray(messages)){$(messages).each(function(c,d){if(typeof d==="object"){let param=d.param;if(typeof param==="string"&&param.length){let elem=$(b).find(':input[name="'+param+'"]');if(elem&&elem.length){$(elem).addClass("is-invalid");let paramMessage=d.message;if(paramMessage.length){let paramMessageElem=$("<div></div>");$(paramMessageElem).addClass("invalid-feedback animated fadeInUp");$(paramMessageElem).text(paramMessage);$(paramMessageElem).insertAfter(elem)}}}}})}}if(a.hasOwnProperty("param")){$(b).find(':input[name="'+a.param+'"]').addClass("is-invalid")}xhrResult(a,b)}}}function xhrMessageNotyType(a){if(typeof a==="string"){a=a.toLowerCase();switch(a){case"notice":return"warning";case"error":case"danger":return"error";case"success":case"info":case"warning":return a;default:return"alert"}}}function xhrResult(a,b){let ignoreFormParams=false;if(b&&b.length){ignoreFormParams=true}if(typeof(a)==="object"){if(a.hasOwnProperty("messages")){let messages=a.messages;if($.isArray(messages)){$(messages).each(function(c,d){if(typeof d==="object"){let msgParam=d.param;if(msgParam&&msgParam.length){if(ignoreFormParams===true){return}}if(d.hasOwnProperty("type")&&d.hasOwnProperty("message")){let notyType=xhrMessageNotyType(d.type);let notyMessage=d.message;let notyLayout="bottomRight";if(notyType==="success"){notyLayout="bottom"}issueNoty3(notyType,notyMessage,notyLayout)}}})}}if(a.hasOwnProperty("status")){if(a.status===false){if(a.hasOwnProperty("totpAuthModal")&&a.totpAuthModal===true){$(totpModal).modal("show")}}if(a.hasOwnProperty("totpModalClose")){$(totpModal).modal("hide")}}let hasErrors=false;if(a.hasOwnProperty("errors")){let errors=a.errors;if($.isArray(errors)&&errors.length>0){hasErrors=true;if(errorsContainer&&errorsContainer.length){let errorsContainerList=$(errorsContainer).find("#errors-list");$(errors).each(function(d,c){if(typeof c==="object"){let thisError=$("<div></div>");$(thisError).addClass("alert alert-dismissible fade show alert-"+xhrMessageNotyType(c.typeStr));$(thisError).text(c.message);$(thisError).append('<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button>');$(errorsContainerList).append(thisError)}});$(errorsContainer).slideDown()}}}let letChangeLocation=true;let changeLocationTrigger=$("<div></div>").addClass("alert alert-warning");if(hasErrors===true){if($(errorsContainer).length){letChangeLocation=false}}if(a.hasOwnProperty("redirect")){if(letChangeLocation===true){setTimeout(function(){document.location.replace(a.redirect)},1500)}else{$(changeLocationTrigger).append('To continue, please click <a href="'+a.redirect+'"><strong>here</strong></a>');$(errorsContainer).find("#errors-list").append(changeLocationTrigger);$(errorsContainer).slideDown()}}else{if(a.hasOwnProperty("refresh")){if(letChangeLocation===true){setTimeout(function(){document.location.reload()},1500)}else{$(changeLocationTrigger).append('To continue, please click <a href="javascript:document.location.reload();"><strong>here</strong></a>');$(errorsContainer).find("#errors-list").append(changeLocationTrigger);$(errorsContainer).slideDown()}}}}}function resetForm(a){if($(a).is("form")){$(a).find(":input").removeClass("is-invalid");$(a).find("div.invalid-feedback").remove()}}function issueNoty3(a,c,d,b){if(d==null){d="bottom"}let notyParams={type:a,layout:d,theme:"bootstrap-v4",text:c,timeout:3500,progressBar:true,animation:{open:"animated fadeInRight",close:"animated fadeOutRight"}};if(typeof(b)==="object"){$.extend(notyParams,b)}new Noty(notyParams).show()}function regularXhrForm(a,b){if($(a).is("form")){resetForm(a);xhrForm(a,function(c){processFormResult(a,c);if(typeof(b)==="function"){b(c)}})}};